<div class="dashboard-wrapper">
    <header class="navbar-modern">
        <div class="nav-left">
            <div class="logo-circle">ðŸ•’</div>
            <div class="brand-info">
                <h1 class="brand-name">TimeTrack</h1>
                <span class="brand-tag">Employee Dashboard</span>
            </div>
        </div>

        <nav class="nav-center">
            <button class="nav-item" [class.active]="activeTab() === 'logging'" (click)="setTab('logging')">
                <span class="icon">ðŸ•’</span> Logs
            </button>
            <button class="nav-item" [class.active]="activeTab() === 'tasks'" (click)="setTab('tasks')">
                <span class="icon">ðŸ“‹</span> Tasks
            </button>
            <button class="nav-item" [class.active]="activeTab() === 'productivity'" (click)="setTab('productivity')">
                <span class="icon">ðŸ“ˆ</span> Insights
            </button>
            <button class="nav-item notif" [class.active]="activeTab() === 'notifications'"
                (click)="setTab('notifications')">
                <span class="icon">ðŸ””</span> Notifications
                <span class="notif-badge" *ngIf="unreadCount() > 0">{{unreadCount()}}</span>
            </button>
        </nav>

        <div class="nav-right">
            <div class="user-pill">
                <div class="user-avatar">{{ authService.currentUser()?.name?.charAt(0) }}</div>
                <div class="user-details">
                    <span class="u-name">{{ authService.currentUser()?.name }}</span>
                    <span class="u-dept">{{ authService.currentUser()?.department || 'Engineering' }}</span>
                </div>
            </div>
            <button class="btn-logout" (click)="logout()" title="Logout">â†ª</button>
        </div>
    </header>

    <div [ngSwitch]="activeTab()" class="tab-content">

        <div *ngSwitchCase="'logging'" class="fade-in">
            <div class="stats-row">
                <div class="card stat-card">
                    <h3>Today's Hours</h3>
                    <p class="stat-number">0 hrs</p>
                </div>
                <div class="card stat-card">
                    <h3>This Week</h3>
                    <p class="stat-number">{{weeklyHours()}} hrs</p>
                </div>
                <div class="card stat-card">
                    <h3>Days Logged</h3>
                    <p class="stat-number">{{timeLogs().length}} days</p>
                </div>
            </div>

            <div class="card table-card">
                <div class="card-header-row">
                    <h3>Time Logs</h3>
                    <button class="btn-primary" (click)="showModal.set(true)">+ Log Time</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>Break</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let log of timeLogs()">
                            <td>{{log.date}}</td>
                            <td>{{log.start}}</td>
                            <td>{{log.end}}</td>
                            <td>{{log.break}}m</td>
                            <td><strong class="text-glow">{{log.total}} hrs</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div *ngSwitchCase="'tasks'" class="fade-in">
            <div class="task-grid">
                <div *ngFor="let task of detailedTasks()" class="task-card card">
                    <div class="task-row">
                        <strong>{{task.title}}</strong>
                        <span class="pill" [attr.data-status]="task.status">{{task.status}}</span>
                    </div>
                    <div class="progress-info">
                        <div class="labels">
                            <span>Progress</span>
                            <span>{{task.currentHours}}/{{task.totalHours}} hrs</span>
                        </div>
                        <div class="progress-bg">
                            <div class="progress-fill" [style.width.%]="task.progress"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div *ngSwitchCase="'productivity'" class="fade-in">
            <div class="charts-grid">
                <div class="card chart-box">
                    <h3>Daily Hours</h3><canvas #hoursChart></canvas>
                </div>
                <div class="card chart-box">
                    <h3>Status Distribution</h3><canvas #statusChart></canvas>
                </div>
            </div>
        </div>

        <div *ngSwitchCase="'notifications'" class="fade-in">
            <div class="notifications-container card">
                <div class="card-header-row">
                    <div class="title-group">
                        <h3>Notifications</h3>
                        <span class="sub-text">{{ unreadCount() }} unread messages</span>
                    </div>
                    <button class="text-btn" (click)="markAllAsRead()">Mark all as read</button>
                </div>
                <div class="notification-list">
                    <div *ngFor="let note of detailedNotifications()" class="note-card-modern"
                        [ngClass]="[note.type, note.read ? 'read-state' : '']">
                        <div class="note-icon-box">
                            <span *ngIf="note.type === 'assignment'">ðŸ“—</span>
                            <span *ngIf="note.type === 'deadline'">ðŸ””</span>
                            <span *ngIf="note.type === 'reminder'">ðŸ•’</span>
                        </div>
                        <div class="note-content">
                            <strong>{{note.message}}</strong>
                            <span class="note-time">{{note.timestamp}}</span>
                        </div>
                        <button class="check-icon" [class.checked]="note.read">âœ”</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" *ngIf="showModal()">
    <div class="modal-card">
        <div class="modal-header">
            <h2>TimeTrack System</h2>
            <p>Log your daily work hours</p>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Select Date</label>
                <input type="date" [(ngModel)]="newLog.date" class="form-control">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" [(ngModel)]="newLog.start" class="form-control">
                </div>
                <div class="form-group">
                    <label>End Time</label>
                    <input type="time" [(ngModel)]="newLog.end" class="form-control">
                </div>
            </div>
            <div class="form-group">
                <label>Break Duration (Mins)</label>
                <input type="number" [(ngModel)]="newLog.break" class="form-control">
            </div>
            <div class="gap-display">Total Logged: <strong>{{ totalGap() }} Hours</strong></div>
            <div class="modal-actions">
                <button class="btn-save" (click)="saveLog()">Save Daily Log</button>
                <button class="btn-cancel" (click)="showModal.set(false)">Cancel</button>
            </div>
        </div>
    </div>
</div>